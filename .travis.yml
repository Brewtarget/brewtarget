language: c++
dist: bionic
os: linux
services:
  - docker
if: tag IS blank
jobs:
  include:
    - stage: Build Binaries
      name: Build for Ubuntu 18.04
      script: ./release-scripts/docker-build-and-release-ubuntu.sh ubuntu1804

    - name: Build for Ubuntu 19.10
      script: ./release-scripts/docker-build-and-release-ubuntu.sh ubuntu1910

    - name: Build for Ubuntu 20.04
      script: ./release-scripts/docker-build-and-release-ubuntu.sh ubuntu2004

    - name: Build for Archlinux
      script: ./release-scripts/docker-build-and-release-archlinux.sh

    - stage: Create draft Github Release
      name: Create a draft Github Release
      script: ./release-scripts/create-draft-release.sh
      if: branch = develop

    - stage: Push Binaries
      name: Push Ubuntu 18.04 binaries
      script: ./release-scripts/push-ubuntu-binaries.sh ubuntu1804
      if: branch = develop

    - name: Push Ubuntu 19.10 binaries
      script: ./release-scripts/push-ubuntu-binaries.sh ubuntu1910
      if: branch = develop

    - name: Push Ubuntu 20.04 binaries
      script: ./release-scripts/push-ubuntu-binaries.sh ubuntu2004
      if: branch = develop

    - name: Push Archlinux Binaries
      script: ./release-scripts/push-archlinux-binaries.sh
      if: branch = develop

    - stage: Finalize Github Release
      name: Finalize  Github Release
      script: ./release-scripts/finalize-draft-release.sh
      if: branch = develop

    - stage: Build GuacGUI Image
      name: Build GuacGUI Image
      script: ./release-scripts/docker-build-and-release-guacgui.sh
      if: branch = develop
env:
  global:
    - DOCKER_USERNAME: cgspeck
    - secure: O0F2xZs8+4etWh7+q56T+G6KSQ23q4Tpoun9goBpkWlHeYknuk0tfPlP1+S3aqVsR3bi8mTZ4lQPz46dfMeGogVAJmAuwrHXqbzmoe2zXn50qxLXu7w0duh/23byn68d7cqGKLmm5Qd9WM4nuJwMnNuFKfQ/erLsXYNO4rwowNq3brwbZ/tKdawCdtc7CvYoZuDQFqJ06fGQHXMw3z6ETFqYgwmvHm0MZa3dRqpqFCYCwhlO+jWH9Sao2U37Rq0gAdzzwQm2B+nb/4ax48iDMs3xHNJRIfJnjIrYHmnVo7xciDawa5794wyeTUXSstsTAnFZ6dJVgvXL2MCDpLMUQMUzpI84uNCwKca8ShvRbPYXpPYiP8K089GLcWEhQuzJTOtb6mRBf51THQ3Z62zt/o+33KmSvbdNKfxh4/ZXyJM8gkQtRlxCMXCZbjjjcRn5O69C2rXlsaUIoimSJ38P+rSki2lCiATI7Pn+cG8c1xexj+6kcdDxaTHFOzF2TbtDvxowiFjK8Pq1jMjgfObVnHKrByf8SB01Edh9Tufyv2GpRyQ5SpTjXvf4XVDJw5LhxyOWxM7ZDvHtyalHclYAZKQFPjtKr6LR53EWS4pxkK2PkoUvHYLLPR6VAXa7CPFE7tiah/JmoexT73AlnZhHk0xPRzNtGnYKjp0ltYyN6m0=
    - secure: dKYSPqNG/3mq35FUUwoCCxoR3f05Gdf6UjGRUooQDrpfDwRDKwWK3LW1MffOH22wmF+s+jC9l7UQodNvb9a86HFnECz38FaCrWQYl6YhQeyBh9FT64zZIVngIVJ3Yi5/ts7NDi0Ja6TB+JvFxoBboClOZVXReFAQa70G5dk6sAWDdir2lEy/54yzNE0Ivws/RuYDWaLGT+728gnCXIfBZHJ8ZdzrQCYIzWAhWJtR7qUimppUIvg6S3rTOZSOhiG+14mDiMe45E69VSiHZWaqqkXqeB3RaK9V6pk+B7t4Uo1F0r9JXmfZMfaj/xz2AggYcFUcOJ1s/fX8Baj8Rtb9H87g2HfFlV5wHgp8e9V+8Dho6CIrPp4LBlq091QzpZmOEiwsI4C7Za4PskRj48UUjNBrFw3Idpyi+S0n7bYrWiaEhvZm1XZlGbCr+acW3WOzAKSWIuNvuA5QJ8ygWZ3fFk32MaAZavh7V2WmFsmS2Bg9lBujyNCElw8Klkrs9On5pijARZZJKuuQ07Wn8US0OdNsuRdq+JRSDFLcJSAz6xidmSiaeZ7KmkLA6/pWLLTdL6zMJbrx1BYZads3u7HN35JBpTqGRrqlZR5lk7/Yybiw7/udhx9kz8kxJulJxbdU1Ul1AIh73fHqMIhSFSHkTK+zu14GIA1Pf7Fut8gUI7s=
