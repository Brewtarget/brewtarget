#
# packaging/linux/rpm.spec.in is part of Brewtarget, and is copyright the following authors 2023-2024:
#   • Matt Young <mfsy@yahoo.com>
#
# Brewtarget is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later
# version.
#
# Brewtarget is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied
# warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
# details.
#
# You should have received a copy of the GNU General Public License along with this program.  If not, see
# <http://www.gnu.org/licenses/>.
#

#
# See comments in meson.build for how this file gets processed into mbuild/packaging/linux/rpm.spec.  Then see comments
#
# See https://rpm-software-management.github.io/rpm/manual/spec.html for format of an RPM spec file
#
# From the command line, you can use `rpm -qi` to query a lot of this info for an existing RPM package (without having
# to install it)
#

# Proper name of the package.  Must not include whitespace or any numeric operators (‘<’, ‘>’,’=’) but may include a
# hyphen ‘-‘
Name        : @CONFIG_APPLICATION_NAME_LC@

# Version
Version     : @CONFIG_VERSION_STRING@

# Package release: used for distinguishing between different builds of the same software version.
Release     : 1

# Short (< 70 characters) summary of the package license
License     : GPL-3.0-or-later

# Optional, short (< 70 characters) group of the package.
Group       : Applications/Productivity

# Short (< 70 characters) summary of the package.
Summary     : GUI beer brewing software

# URL supplying further information about the package, typically upstream website.
URL         : @CONFIG_WEBSITE_URL@
Vendor      : @CONFIG_ORGANIZATION_NAME@

# Specifies the architecture which the resulting binary package will run on. Typically this is a CPU architecture.
BuildArch   : x86_64

#
# Dependencies
#
# Format is similar to Dependencies in Debian (.deb) package control file, but (a) without brackets around version
# numbers and (b) '-' and '.' are sometimes replaced by '_' in package names.
#
# You can search online for rpm packages at, eg, https://rpmfind.net/
#
# We essentially start with the Debian dependencies and look for RPM equivalents, which have similar, but often slightly
# different, names.  (There would be a more direct way of doing things if we were building on an RPM-based distro, but
# we aren't.)  Note that, per https://centoshelp.org/resources/faqs/yum-rpm-faq/, RPM package package names are
# case-sensitive.  (We've ignored this in the past and made everything lower case without error or complaint, but it
# doesn't hurt to try to follow the standards!)
#
# We exclude the following RPM packages:
#    - glibc-devel : Gives rpmlint error "devel-dependency" = " "Your package has a dependency on a devel package but
#                    it's not a devel package itself.
#
# As with .deb package control file, we do our own line folding in the bt build script, so the backslash line
# continuations are OK here!
#
Requires    : \
   glibc                 >= 2.35  , \
   glibc-32bit           >= 2.35  , \
   libgcc_s1-32bit       >= 12.2.0, \
   libstdc++6-32bit      >= 12.2.0, \
   libgcc_s1             >= 12.2.0, \
   libstdc++6            >= 12.2.0, \
   libQt6Core6           >= 6.2.4 , \
   libQt6Gui6            >= 6.2.4 , \
   libQt6Multimedia6     >= 6.2.4 , \
   libQt6Network6        >= 6.2.4 , \
   libQt6PrintSupport6   >= 6.2.4 , \
   libQt6Sql6            >= 6.2.4 , \
   libqt6svg6            >= 6.2.4 , \
   libQt6Widgets6        >= 6.2.4 , \
   libxalan-c112         >= 1.12  , \
   libxerces-c-3_2       >= 3.2.3 , \
   qt6-translations-l10n >= 6.2.4

# Description is done in a different way, perhaps because it's a multi-line field
%description
@CONFIG_APPLICATION_NAME_UC@ is a calculator for brewing beer. It is a Qt-based program which
allows you to create recipes from a database of ingredients. It calculates
all the important parameters, helps you with mash temperatures, and just
makes the process of recipe formulation much easier.

# The files in the package
# These are specified by where they will be installed, hence the absolute paths but we can use glob patterns based on
# what's in the build tree
%files
/usr/bin/*
/usr/share/applications/*
/usr/share/@CONFIG_APPLICATION_NAME_LC@/*
/usr/share/doc/@CONFIG_APPLICATION_NAME_LC@/*
/usr/share/icons/hicolor/scalable/apps/*
/usr/share/man/man1/*
/usr/share/metainfo/*

#
# Change log is a required section
# By default, you are expected to have the full change log right here in this spec file.  (I think there might be a way
# to pull in the change log data from a separate file, but I didn't yet figure it out.)  So, for now at least, we get
# the `bt` build tool script to append the changelog data after this file is processed.
#
# *** NB: THIS MEANS %changelog MUST BE THE LAST ENTRY IN THE FILE.  DO NOT ADD ANY LINES AFTER IT. ***
#
%changelog